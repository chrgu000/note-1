<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>工作笔记</title>
    <link>http://dishui.oschina.io/categories/mysql/index.xml</link>
    <description>Recent content on 工作笔记</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <atom:link href="http://dishui.oschina.io/categories/mysql/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Mysql错误</title>
      <link>http://dishui.oschina.io/post/linux/mysqlcuo_wu/</link>
      <pubDate>Sun, 01 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>http://dishui.oschina.io/post/linux/mysqlcuo_wu/</guid>
      <description>

&lt;h2 id=&#34;mysql错误&#34;&gt;Mysql错误&lt;/h2&gt;

&lt;h3 id=&#34;mysql-daemon-failed-to-start&#34;&gt;&lt;code&gt;MySQL Daemon failed to start.&lt;/code&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bash
#查看mysql日志
less /var/log/mysqld.log 
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unknown variable &#39;default-character-set=utf8&#39;&lt;/code&gt;
&lt;code&gt;
用character_set_server=utf8来取代 default-character-set=utf8
&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;cannot-load-from-mysql-proc-the-table-is-probably-corrupted&#34;&gt;&lt;code&gt;Cannot load from mysql.proc. The table is probably corrupted&lt;/code&gt;&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#
use mysql;
#
ALTER TABLE `proc` MODIFY COLUMN `comment`  text CHARACTER SET utf8 COLLATE utf8_bin NOT NULL AFTER `sql_mode`;
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>mycat命令</title>
      <link>http://dishui.oschina.io/post/linux/mycat/mycat-command-line/</link>
      <pubDate>Sun, 01 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>http://dishui.oschina.io/post/linux/mycat/mycat-command-line/</guid>
      <description>&lt;div id=&#34;toc&#34; class=&#34;toc&#34;&gt;
&lt;div id=&#34;toctitle&#34;&gt;Contents&lt;/div&gt;
&lt;ul class=&#34;sectlevel1&#34;&gt;
&lt;li&gt;&lt;a href=&#34;#_mycat_命令行监控&#34;&gt;1. MyCAT  命令行监控&lt;/a&gt;
&lt;ul class=&#34;sectlevel3&#34;&gt;
&lt;li&gt;&lt;a href=&#34;#__code_kill_connection_code&#34;&gt;1.1. &lt;code&gt;KILL @@CONNECTION&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_mycat_命令行监控&#34;&gt;1. MyCAT  命令行监控&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;用mysql命令行连接 &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;mysql –utest –ptest –P9066 -h172.17.0.4&lt;br&gt;
mysql –utest –ptest –P8066 -h172.17.0.4 (jdbc连接)&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@HELP&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;可显示所有相关管理命令&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@BACKEND&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示后端物理库连接信息，包括当前连接数，端口&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; show @@backend\G;
*************************** 1. row ***************************
 processor: Processor0
        id: 12
   mysqlId: 5
      host: mysqlSlave
      port: 3306
    l_port: 34828
    net_in: 3389
   net_out: 861
      life: 2661
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 2. row ***************************
 processor: Processor0
        id: 6
   mysqlId: 10
      host: mysqlMaster
      port: 3306
    l_port: 39710
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 3. row ***************************
 processor: Processor0
        id: 13
   mysqlId: 6
      host: mysqlSlave
      port: 3306
    l_port: 34830
    net_in: 3389
   net_out: 861
      life: 2661
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 4. row ***************************
 processor: Processor0
        id: 5
   mysqlId: 6
      host: mysqlMaster
      port: 3306
    l_port: 39702
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 5. row ***************************
 processor: Processor0
        id: 18
   mysqlId: 11
      host: mysqlSlave
      port: 3306
    l_port: 34842
    net_in: 1439
   net_out: 393
      life: 1461
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 6. row ***************************
 processor: Processor0
        id: 7
   mysqlId: 11
      host: mysqlMaster
      port: 3306
    l_port: 39712
    net_in: 2043
   net_out: 537
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 7. row ***************************
 processor: Processor0
        id: 8
   mysqlId: 7
      host: mysqlMaster
      port: 3306
    l_port: 39704
    net_in: 2043
   net_out: 537
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 8. row ***************************
 processor: Processor0
        id: 17
   mysqlId: 10
      host: mysqlSlave
      port: 3306
    l_port: 34840
    net_in: 1739
   net_out: 465
      life: 1761
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 9. row ***************************
 processor: Processor0
        id: 2
   mysqlId: 4
      host: mysqlMaster
      port: 3306
    l_port: 39698
    net_in: 2043
   net_out: 537
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 10. row ***************************
 processor: Processor0
        id: 9
   mysqlId: 3
      host: mysqlMaster
      port: 3306
    l_port: 39696
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 11. row ***************************
 processor: Processor0
        id: 10
   mysqlId: 12
      host: mysqlMaster
      port: 3306
    l_port: 39714
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 12. row ***************************
 processor: Processor0
        id: 16
   mysqlId: 9
      host: mysqlSlave
      port: 3306
    l_port: 34838
    net_in: 2114
   net_out: 555
      life: 2061
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 13. row ***************************
 processor: Processor0
        id: 15
   mysqlId: 8
      host: mysqlSlave
      port: 3306
    l_port: 34836
    net_in: 2639
   net_out: 681
      life: 2361
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 14. row ***************************
 processor: Processor0
        id: 1
   mysqlId: 9
      host: mysqlMaster
      port: 3306
    l_port: 39708
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 15. row ***************************
 processor: Processor0
        id: 14
   mysqlId: 7
      host: mysqlSlave
      port: 3306
    l_port: 34834
    net_in: 2639
   net_out: 681
      life: 2361
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 16. row ***************************
 processor: Processor0
        id: 3
   mysqlId: 8
      host: mysqlMaster
      port: 3306
    l_port: 39706
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 17. row ***************************
 processor: Processor0
        id: 11
   mysqlId: 4
      host: mysqlSlave
      port: 3306
    l_port: 34826
    net_in: 3389
   net_out: 861
      life: 2661
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true
*************************** 18. row ***************************
 processor: Processor0
        id: 4
   mysqlId: 5
      host: mysqlMaster
      port: 3306
    l_port: 39700
    net_in: 2118
   net_out: 555
      life: 2662
    closed: false
  borrowed: false
SEND_QUEUE: 0
    schema: testdb
   charset: latin1:8
   txlevel: 0
autocommit: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@CONNECTION&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示当前前端客户端连接情况，已经网络流量信息&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@CONNECTION\G;
*************************** 1. row ***************************
    PROCESSOR: Processor0
           ID: 6
         HOST: 172.18.0.3
         PORT: 9066
   LOCAL_PORT: 41268
         USER: test
       SCHEMA: NULL
      CHARSET: utf8:33
       NET_IN: 1075
      NET_OUT: 20439
ALIVE_TIME(S): 1453
  RECV_BUFFER: 4096
   SEND_QUEUE: 0
      txlevel:
   autocommit:
*************************** 2. row ***************************
    PROCESSOR: Processor0
           ID: 7
         HOST: 172.18.0.4
         PORT: 9066
   LOCAL_PORT: 42998
         USER: test
       SCHEMA: NULL
      CHARSET: utf8:33
       NET_IN: 247
      NET_OUT: 7395
ALIVE_TIME(S): 878
  RECV_BUFFER: 4096
   SEND_QUEUE: 0
      txlevel:
   autocommit:&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@THREADPOOL&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;当前线程池的执行情况，是否有积压(active_count)以及task_queue_size，后者为积压的待处理的SQL，若积压数目一直保值，则说明后端物理连接可能不够或者SQL执行比较缓慢。&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;*************************** 1. row ***************************
           NAME: Timer
      POOL_SIZE: 2
   ACTIVE_COUNT: 0
TASK_QUEUE_SIZE: 0
 COMPLETED_TASK: 8972
     TOTAL_TASK: 8972
*************************** 2. row ***************************
           NAME: BusinessExecutor
      POOL_SIZE: 4
   ACTIVE_COUNT: 0
TASK_QUEUE_SIZE: 0
 COMPLETED_TASK: 26
     TOTAL_TASK: 26&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@HEARTBEAT&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;当前后端物理库的心跳检测情况,RS_CODE为1表示心跳正常&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@HEARTBEAT\G;
*************************** 1. row ***************************
            NAME: mysqlMaster
            TYPE: mysql
            HOST: mysqlMaster
            PORT: 3306
         RS_CODE: 1
           RETRY: 0
          STATUS: idle
         TIMEOUT: 0
    EXECUTE_TIME: 0,0,1
LAST_ACTIVE_TIME: 2016-07-22 07:28:54
            STOP: false
*************************** 2. row ***************************
            NAME: mysqlSlave
            TYPE: mysql
            HOST: mysqlSlave
            PORT: 3306
         RS_CODE: 1
           RETRY: 0
          STATUS: idle
         TIMEOUT: 0
    EXECUTE_TIME: 0,0,0
LAST_ACTIVE_TIME: 2016-07-22 07:28:54
            STOP: false&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@DATANODE&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示数据节点的访问情况，包括每个数据节点当前活动连接数(active),空闲连接数（idle）以及最大连接数(maxCon) size，EXECUTE参数表示从该节点获取连接的次数，次数越多，说明访问该节点越多。&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@DATANODE\G;
*************************** 1. row ***************************
         NAME: dn1
      DATHOST: localhost1/testdb
        INDEX: 0
         TYPE: mysql
       ACTIVE: 0
         IDLE: 10
         SIZE: 1000
      EXECUTE: 445
   TOTAL_TIME: 0
     MAX_TIME: 0
      MAX_SQL: 0
RECOVERY_TIME: -1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@PROCESSOR&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示当前processors的处理情况，包括每个processor的IO吞吐量(NET_IN/NET_OUT)、IO队列的积压情况(R_QUEY/W_QUEUE)，Socket Buffer Pool的使用情况BU_PERCENT为已使用的百分比、BU_WARNS为Socket Buffer Pool不够时，临时创新的新的BUFFER的次数，若百分比经常超过90%并且BU_WARNS&amp;gt;0，则表明BUFFER不够，需要增大，参见性能调优手册。&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@PROCESSOR\G;
*************************** 1. row ***************************
        NAME: Processor0
      NET_IN: 84569
     NET_OUT: 60967
 REACT_COUNT: 0
     R_QUEUE: 0
     W_QUEUE: 0
 FREE_BUFFER: 974
TOTAL_BUFFER: 1000
  BU_PERCENT: 2
    BU_WARNS: 875
    FC_COUNT: 2
    BC_COUNT: 18&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@DATASOURCE&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示数据源的信息，是否是读写节点等。&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@DATASOURCE\G;
*************************** 1. row ***************************
DATANODE: dn1
    NAME: mysqlMaster
    TYPE: mysql
    HOST: mysqlMaster
    PORT: 3306
     W/R: W
  ACTIVE: 0
    IDLE: 10
    SIZE: 1000
 EXECUTE: 451
*************************** 2. row ***************************
DATANODE: dn1
    NAME: mysqlSlave
    TYPE: mysql
    HOST: mysqlSlave
    PORT: 3306
     W/R: R
  ACTIVE: 0
    IDLE: 8
    SIZE: 1000
 EXECUTE: 457&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;SHOW @@CACHE&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;显示缓存的使用情况，对于性能监控和调优很有价值
MAX为缓存的最大值（记录个数），CUR为当前已经在缓存中的数量，ACESS为缓存读次数，HIT为缓存命中次数，PUT 为写缓存次数，LAST_XX为最后操作时间戳，比较重要的几个参数：CUR：若CUR接近MAX，而PUT大于MAX很多，则表明MAX需要增大，HIT/ACCESS为缓存命中率，这个值越高越好。&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; SHOW @@CACHE\G;
*************************** 1. row ***************************
      CACHE: SQLRouteCache
        MAX: 10000
        CUR: 0
     ACCESS: 9
        HIT: 0
        PUT: 0
LAST_ACCESS: 1469171194202
   LAST_PUT: 0
*************************** 2. row ***************************
      CACHE: TableID2DataNodeCache.TESTDB_ORDERS
        MAX: 50000
        CUR: 0
     ACCESS: 0
        HIT: 0
        PUT: 0
LAST_ACCESS: 0
   LAST_PUT: 0
*************************** 3. row ***************************
      CACHE: ER_SQL2PARENTID
        MAX: 1000
        CUR: 0
     ACCESS: 0
        HIT: 0
        PUT: 0
LAST_ACCESS: 0
   LAST_PUT: 0&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect3&#34;&gt;
&lt;h4 id=&#34;__code_kill_connection_code&#34;&gt;1.1. &lt;code&gt;KILL @@CONNECTION&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;杀掉客户端的连接，参数为连接的ID值，通过show @@connection，可以展示当前连接到MyCAT的所有客户端进程，若某个进程异常，则可以通过该命令杀掉连接，如 KILL @@CONNECTION 1;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>mysql主从配置</title>
      <link>http://dishui.oschina.io/post/linux/mysql-master-slave/</link>
      <pubDate>Sun, 01 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>http://dishui.oschina.io/post/linux/mysql-master-slave/</guid>
      <description>&lt;div id=&#34;toc&#34; class=&#34;toc&#34;&gt;
&lt;div id=&#34;toctitle&#34;&gt;Mysql 主从复制&lt;/div&gt;
&lt;ul class=&#34;sectlevel1&#34;&gt;
&lt;li&gt;&lt;a href=&#34;#_mysql_主从复制&#34;&gt;1. Mysql 主从复制&lt;/a&gt;
&lt;ul class=&#34;sectlevel2&#34;&gt;
&lt;li&gt;&lt;a href=&#34;#_master&#34;&gt;1.1. master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#__code_slave_code&#34;&gt;1.2. &lt;code&gt;slave&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#_安装_code_mysql_code_centos_7_x64_strong_master_strong&#34;&gt;1.3. 安装 &lt;code&gt;mysql&lt;/code&gt; (CentOS-7 x64)  &lt;strong&gt;master&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#_安装_code_mysql_code_centos_7_x64_slave&#34;&gt;1.4. 安装 &lt;code&gt;mysql&lt;/code&gt; (CentOS-7 x64) Slave&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_mysql_主从复制&#34;&gt;1. Mysql 主从复制&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_master&#34;&gt;1.1. master&lt;/h3&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;启用二进制日志&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;log-bin = master-bin
log-bin-index = master-bin.index&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选择一个唯一 &lt;code&gt;server-id&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;server-id = {0-2^32}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建具有复制权限的用户&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;REPLICATION SLAVE
REPLICATION CLIENT&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;__code_slave_code&#34;&gt;1.2. &lt;code&gt;slave&lt;/code&gt;&lt;/h3&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;启动中继日志&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;relay-log = relay-log&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选择一个唯一的 &lt;code&gt;server-id&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;server-id = {0-2^32}  # 不能和主服务器相同&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;连接至主服务器,并开始复制数据&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;mysql&amp;gt; CHANGE MASTER TO MASTER_HOST=&#39;&#39;,MASTER_PORT=&#39;&#39;,MASTER_LOG_FILE=&#39;&#39;,MASTER_LOG_POS=&#39;&#39;,MASTER_USER=&#39;&#39;,MASTER_PASSWORD=&#39;&#39;;
mysql&amp;gt; START SLAVE; 启动从服务器线程&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;复制线程 &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;master: dump
slave: IO_Thread, SQL_Thread&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_安装_code_mysql_code_centos_7_x64_strong_master_strong&#34;&gt;1.3. 安装 &lt;code&gt;mysql&lt;/code&gt; (CentOS-7 x64)  &lt;strong&gt;master&lt;/strong&gt;&lt;/h3&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;mysql-master
asciinema::slave[&#34;mysql2&#34;,&#34;/src/records/mysql-master.json&#34;,&#34;95&#34;,&#34;25&#34;]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装 &lt;code&gt;mysql&lt;/code&gt; 源&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;curl -L http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm &amp;gt; mysql.rpm
yum localinstall mysql.rpm -y&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;指定安装 &lt;code&gt;mysql5.6&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;vim /etc/yum.repos.d/mysql-community.repo
##
# Enable to use MySQL 5.6
[mysql56-community]
name=MySQL 5.6 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/6/$basearch/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
##
# diable to use MySQL 5.7
[mysql57-community]
name=MySQL 5.7 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/$basearch/
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;yum install mysql-community-server -y
# mysql 数据存储目录
mkdir -p /mysql/data
# 更改权限
chown -hR mysql:mysql /mysql&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;openblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;配置文件 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;[client]
#password       = your_password
port            = 3306
socket          = /var/lib/mysql/mysql.sock

[mysqld]
port            = 3306
user            = mysql
pid-file        = /var/lib/mysql/mysql.pid
socket          = /var/lib/mysql/mysql.sock
datadir         = /var/lib/mysql
skip-external-locking
key_buffer_size = 384M
max_allowed_packet = 1M
table_open_cache = 512
sort_buffer_size = 2M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
myisam_sort_buffer_size = 64M
thread_cache_size = 8
query_cache_size = 32M

log-bin = master-bin
log-bin-index= master-bin.index
sync-binlog = ON

binlog_format=mixed

server-id = 1
# 忽略大小写
lower_case_table_names = 1
innodb_file_per_table = 1
character_set_server = utf8
log-error=/var/log/mysqld.log


[mysqldump]
quick
max_allowed_packet = 16M

[mysql]
no-auto-rehash
# Remove the next comment character if you are not familiar with SQL
#safe-updates
[myisamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;初始化数据 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql_install_db --datadir=/mysql/data --user=mysql --defaults-file=/etc/my.cnf&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;授权 &lt;code&gt;REPLICATION&lt;/code&gt; 远程登录 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repluser&#39;@&#39;172.17.%.%&#39; IDENTIFIED BY &#39;replpass&#39;;
mysql&amp;gt;FLUSH PRIVILEGES;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;master&lt;/code&gt; 查看 &lt;code&gt;BINLOG&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; SHOW MASTER STATUS;
mysql&amp;gt; SHOW BINLOG EVENTS IN &#39;master-bin.000001&#39;;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_安装_code_mysql_code_centos_7_x64_slave&#34;&gt;1.4. 安装 &lt;code&gt;mysql&lt;/code&gt; (CentOS-7 x64) Slave&lt;/h3&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;mysql-slave
asciinema::slave[&#34;mysql1&#34;,&#34;/src/records/mysql-slave.json&#34;,&#34;95&#34;,&#34;25&#34;]&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;openblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;div class=&#34;dlist&#34;&gt;
&lt;dl&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;配置文件 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;[client]
#password       = your_password
port            = 3306
socket          = /var/lib/mysql/mysql.sock

[mysqld]
port            = 3306
user            = mysql
pid-file        = /var/lib/mysql/mysql.pid
socket          = /var/lib/mysql/mysql.sock
datadir         = /var/lib/mysql
skip-external-locking
key_buffer_size = 384M
max_allowed_packet = 1M
table_open_cache = 512
sort_buffer_size = 2M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
myisam_sort_buffer_size = 64M
thread_cache_size = 8
query_cache_size = 32M

relay-log = relay-log
relay-log-index = relay-log.index
read-only = ON
binlog_format=mixed
server-id = 12
innodb_file_per_table = 1
# 忽略大小写
lower_case_table_names = 1
character_set_server = utf8
log-error=/var/log/mysqld.log

[mysqldump]
quick
max_allowed_packet = 16M

[mysql]
no-auto-rehash
# Remove the next comment character if you are not familiar with SQL
#safe-updates
[myisamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;连接 &lt;code&gt;mysql-master&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; CHANGE MASTER TO MASTER_HOST=&#39;172.17.0.2&#39;,MASTER_USER=&#39;repluser&#39;,MASTER_PASSWORD=&#39;replpass&#39;,MASTER_LOG_FILE=&#39;master-bin.000006&#39;,MASTER_LOG_POS=410;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;slave&lt;/code&gt; 查看 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; SHOW SLAVE STATUS\G;
*************************** 1. row ***************************
+
               Slave_IO_State:
                  Master_Host: 172.17.0.2
                  Master_User: repluser
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: master-bin.000006
          Read_Master_Log_Pos: 410
               Relay_Log_File: relay-log.000001
                Relay_Log_Pos: 4
        Relay_Master_Log_File: master-bin.000006
             Slave_IO_Running: No
            Slave_SQL_Running: No
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 410
              Relay_Log_Space: 120
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: NULL
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 0
                  Master_UUID:
             Master_Info_File: /mysql/data/master.info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State:
           Master_Retry_Count: 86400
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: 0
1 row in set (0.00 sec)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;启动 &lt;code&gt;slave&lt;/code&gt; &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; START SLAVE;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;&lt;code&gt;slave&lt;/code&gt; 再次查看 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; SHOW SLAVE STATUS\G;
*************************** 1. row ***************************
+
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 172.17.0.2
                  Master_User: repluser
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: master-bin.000006
          Read_Master_Log_Pos: 410
               Relay_Log_File: relay-log.000003
                Relay_Log_Pos: 284
        Relay_Master_Log_File: master-bin.000006
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 410
              Relay_Log_Space: 571
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 1
                  Master_UUID: 35f7ec52-4c03-11e6-8286-0242ac110002
             Master_Info_File: /mysql/data/master.info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it
           Master_Retry_Count: 86400
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: 0
1 row in set (0.00 sec)

ERROR:
No query specified&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;查看 &lt;code&gt;mysql&lt;/code&gt; 环境变量 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;mysql&amp;gt; SHOW GLOBAL VARIABLES LIKE &#39;read_only&#39;;
mysql&amp;gt; SHOW GLOBAL VARIABLES LIKE &#39;%slave%&#39;;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;read-only = YES &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;在从服务器上设定,但对具有SUPER权限的用户不生效&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;sync-binlog = ON &lt;/dt&gt;
&lt;dd&gt;
&lt;p&gt;在主服务器上设定,用于事务安全&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;测试主从复制 &lt;/dt&gt;
&lt;dd&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlightjs highlight&#34;&gt;&lt;code&gt;CREATE DATABASE `test`;
CREATE TABLE `test` (
  `aa` bigint(20) NOT NULL,
  `bb` blob,
  PRIMARY KEY (`aa`)
) ENGINE=MyISAM DEFAULT CHARSET=gbk&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/dd&gt;
&lt;dt class=&#34;hdlist1&#34;&gt;Q&amp;amp;A &lt;/dt&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class=&#34;qlist qanda&#34;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work.?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;code&gt;bash
cd /mysql/data
rm -f auto.cnf
&lt;/code&gt;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>mysql基础操作</title>
      <link>http://dishui.oschina.io/post/linux/mysql1/</link>
      <pubDate>Sun, 01 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>http://dishui.oschina.io/post/linux/mysql1/</guid>
      <description>

&lt;p&gt;include::content/post/base.adoc[]
:toc-title: Contents
&lt;!-- toc --&gt;&lt;/p&gt;

&lt;h1 id=&#34;mysql&#34;&gt;mysql&lt;/h1&gt;

&lt;h3 id=&#34;linux安装mysql设置&#34;&gt;linux安装mysql设置&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/usr/bin/mysqladmin -u root password &#39;123&#39;&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;设置mysql用户名/密码&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mysql&lt;/code&gt;状态/开启/停止

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;service mysqld status&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;service mysqld start&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;service mysqld stop&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;任意主机以用户root和密码mypwd连接到mysql服务器
&lt;code&gt;
mysql&amp;gt; GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123&#39; WITH GRANT OPTION;
mysql&amp;gt; flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;IP为&lt;code&gt;192.168.1.102&lt;/code&gt;的主机以用户myuser和密码mypwd连接到mysql服务器
&lt;code&gt;
mysql&amp;gt; GRANT ALL PRIVILEGES ON *.* TO &#39;myuser&#39;@&#39;192.168.1.102&#39; IDENTIFIED BY &#39;mypwd&#39; WITH GRANT OPTION;
mysql&amp;gt; flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;mysql-备份-还原&#34;&gt;Mysql 备份/还原&lt;/h3&gt;

&lt;p&gt;1、 导出结构不导出数据&lt;/p&gt;

&lt;p&gt;&lt;code&gt;mysqldump -d 数据库名 -uroot -p &amp;gt; xxx.sql&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2、导出数据不导出结构&lt;/p&gt;

&lt;p&gt;&lt;code&gt;mysqldump -t 数据库名 -uroot -p &amp;gt; xxx.sql&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;3、 导出数据和表结构&lt;/p&gt;

&lt;p&gt;&lt;code&gt;mysqldump 数据库名 -uroot -p &amp;gt; xxx.sql&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;4、导出特定表的结构&lt;/p&gt;

&lt;p&gt;&lt;code&gt;mysqldump -uroot -p -B数据库名 --table 表名 &amp;gt; xxx.sql&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;5、 source 还原&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;mysql&amp;gt;source d:\wcnc_db.sql
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;6、windows下导入数据库&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;mysql -uroot -p111111 -Dmailiqing&amp;lt;c:\Users\dishui\Desktop\tmp\mailiqing2016-01-20.sql
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;mysql数据库操作&#34;&gt;mysql数据库操作&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;创建数据库(编码utf8)&lt;/strong&gt;
&lt;code&gt;bash
CREATE DATABASE `mailiqing` CHARACTER SET utf8; 
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;终端shell连接数据库乱码&#34;&gt;终端shell连接数据库乱码&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;mysql -uroot -h192.168.1.123 -p --default-character-set=utf8
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;数据库编码&#34;&gt;数据库编码&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;查看mysql编码
&lt;code&gt;bash
show variables like &#39;character%&#39;;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | utf8                       |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | utf8                       |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
--查看数据库编码
SHOW VARIABLES LIKE &#39;character_set_database&#39;; 
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;mysql-修改密码&#34;&gt;&lt;code&gt;mysql&lt;/code&gt;修改密码&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;关闭&lt;code&gt;mysql&lt;/code&gt;服务&lt;/strong&gt;
&lt;code&gt;bash
service mysqld stop
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;安全方式连接&lt;code&gt;mysql&lt;/code&gt;&lt;/strong&gt;
&lt;code&gt;bash
mysqld_safe --skip-grant-tables
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;进入数据库&lt;/strong&gt;
&lt;code&gt;bash
mysql
#
use mysql;
#
select * from user;                     
Empty set (0.00 sec)
#
INSERT INTO mysql.user (Host,User,Password) VALUES(&#39;%&#39;,&#39;root&#39;, PASSWORD(&#39;luhua123&#39;));
#
update user set password=password(&#39;luhua123&#39;) where user=&#39;root&#39;; 
#
flush privileges;
#
exit;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;杀死&lt;code&gt;mysql&lt;/code&gt;进程&lt;/strong&gt;
&lt;code&gt;bash
service mysqld stop
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;mysql-新增-删除用户和权限分配&#34;&gt;mysql 新增、删除用户和权限分配&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;新增用户
&lt;code&gt;sql
--
insert into mysql.user(Host,User,Password) values(&amp;quot;localhost&amp;quot;,&amp;quot;lionbule&amp;quot;,password(&amp;quot;hello1234&amp;quot;));
--
flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修改用户密码
&lt;code&gt;sql
--
update mysql.user set password=password(&#39;new password&#39;) where User=&amp;quot;lionbule&amp;quot; and Host=&amp;quot;localhost&amp;quot;;
--
flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;删除用户
&lt;code&gt;sql
--
DELETE FROM user WHERE User=&amp;quot;lionbule&amp;quot; and Host=&amp;quot;localhost&amp;quot;;
--
flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;权限分配

&lt;ol&gt;
&lt;li&gt;grant用法
&lt;code&gt;
权限：
常用总结, ALL/ALTER/CREATE/DROP/SELECT/UPDATE/DELETE
数据库：
*.*                    表示所有库的所有表
test.*                表示test库的所有表
test.test_table  表示test库的test_table表     
用户名：
mysql账户名
登陆主机：
允许登陆mysql server的客户端ip
&#39;%&#39;表示所有ip
&#39;localhost&#39; 表示本机
&#39;192.168.10.2&#39; 特定IP
密码：
账户对应的登陆密码
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;例子
&lt;code&gt;sql
grant all  on test.* to lionbule@&#39;%&#39; identified by &#39;hello1234&#39;;
flush privileges;
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;存储过程&#34;&gt;存储过程&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;查看存储过程
&lt;code&gt;sql
SHOW CREATE PROCEDURE `mailiqing`.`product_call`; 
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;查看&#34;&gt;查看&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;数据库编码
&lt;code&gt;sql
SHOW VARIABLES LIKE &#39;character_set_database&#39;;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;改变数据库编码
&lt;code&gt;sql
ALTER DATABASE `mailiqing` CHARACTER SET utf8; 
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;mysql-备份数据库&#34;&gt;&lt;code&gt;mysql&lt;/code&gt;备份数据库&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;code&gt;sql
mysqldump mailiqing -uroot -h192.168.1.123 -p --default-character-set=utf8 --ignore-table=mailiqing.ti_normal_asphaltpara &amp;gt; data.sql
&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>