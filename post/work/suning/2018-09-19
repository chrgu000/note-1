echo "some_metric 3.14" | curl --data-binary @- http://dev.cxzx.fabx.com.cn/pushgateway/metrics/job/some_job


http://dev.cxzx.fabx.com.cn/prometheus



    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/rewrite-target: /


dev.cxzx.fabx.com.cn/dashboard




for ((i=1; i<=1000; i ++))
do
  echo "some_metric $i" | curl --data-binary @- http://dev.cxzx.fabx.com.cn/pushgateway/metrics/job/some_job
  sleep 2
done


${CXZX-T1-TOMCAT_SERVICE_HOST}


10.200.169.32

cxzx.fabx.com.cn  
dev.cxzx.fabx.com.cn

monitor.fabx.com.cn
bash.fabx.com.cn
dashboard.fabx.com.cn

#weave
http://10.200.169.32:32404



node_scrape_collector_duration_seconds{instance=~"$node:$port",job=~"$job"}

{{collector}} - Scrape duration

go_gc_duration_seconds{instance=~"$node:$port",job=~"$job",quantile="1"}


some_{exported_job="some_job",instance=~"$node:$port",job=~"$job"}



联赛
http://sportdata.suning.com/sdsp-web/all/team/getCompetitionRank.do?appCode=common&token=common_Ese32Cee9&competitionId=1&seasonId=1215

杯赛
http://sportdata.suning.com/sdsp-web/all/team/getCompetitionRank.do?appCode=common&token=common_Ese32Cee9&competitionId=14&seasonId=128

积分
 赢 +3
 平 +1
 输 +0

searchGroupsCount


100 - (avg by (instance) (irate(wmi_cpu_cstate_seconds_total{mode="idle"}[5m])) * 100)


100 - (avg by (instance) (irate(wmi_cpu_time_total{job="wim",mode="idle"}[5m])) * 100)


sum by (mode) (rate(wmi_cpu_time_total{instance="10.200.168.14:9182"}[5m]))


sum by (mode) (rate(wmi_cpu_time_total{instance="10.200.168.14:9182"}[5m]))


kubectl-1.10.5-0.x86_64
kubelet-1.10.5-0.x86_64
kubeadm-1.10.5-0.x86_64


kubectl kubelet kubeadm
https://cloud.weave.works/k8s/scope.yaml?k8s-version=$(kubectl version | base64 | tr -d '\n')

https://cloud.weave.works/k8s/scope.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxMCIsIEdpdFZlcnNpb246InYxLjEwLjUiLCBHaXRDb21taXQ6IjMyYWMxYzkwNzNiMTMyYjhiYTE4YWE4MzBmNDZiNzdkY2NlYjA3MjMiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE4LTA2LTIxVDExOjQ2OjAwWiIsIEdvVmVyc2lvbjoiZ28xLjkuMyIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9ClNlcnZlciBWZXJzaW9uOiB2ZXJzaW9uLkluZm97TWFqb3I6IjEiLCBNaW5vcjoiMTAiLCBHaXRWZXJzaW9uOiJ2MS4xMC41IiwgR2l0Q29tbWl0OiIzMmFjMWM5MDczYjEzMmI4YmExOGFhODMwZjQ2Yjc3ZGNjZWIwNzIzIiwgR2l0VHJlZVN0YXRlOiJjbGVhbiIsIEJ1aWxkRGF0ZToiMjAxOC0wNi0yMVQxMTozNDoyMloiLCBHb1ZlcnNpb246ImdvMS45LjMiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQo=




https://github.com/mindprince/nvidia_gpu_prometheus_exporter
https://github.com/zhebrak/nvidia_smi_exporter

nvidia-smi --query-gpu=name,index,temperature.gpu,utilization.gpu,utilization.memory,memory.total,memory.free,memory.used --format=csv,noheader,nounits


nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits

.\wmi_exporter.exe --log.format logger:eventlog?name=wmi_exporter  --telemetry.addr :9182



export http_proxy=http://127.0.0.1:7777
export https_proxy=http://127.0.0.1:7777


http_proxy=http://127.0.0.1:7777 go get  honnef.co/go/staticcheck/cmd/staticcheck


go install github.com/prometheus/node_exporter


((count(count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu))) - avg(sum by (mode)(irate(node_cpu_seconds_total{mode='idle',instance=~"$node:$port",job=~"$job"}[5m]))))


/ 


count(count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu))

sum by 


sum by (mode)(irate(node_gpu_utilization_gpu{instance=~"$node:$port",job=~"$job"}[10s])))



[Unit]
Description=node_exporter daemon

[Service]
Type=simple
ExecStart=/home/ubuntu/go/bin/node_exporter --web.listen-address=":9182"

[Install]
WantedBy=multi-user.target



sum(node_gpu_utilization_gpu{instance=~"$node:$port",job=~"$job"})/4

node_gpu_utilization_gpu{instance=~"$node:$port",job=~"$job"}

Windows Node
2129

Node Exporter Full
1860

Nvidia GPU
6387


192.168.88.32   dashboard.fabx.com.cn
192.168.88.32   bash.fabx.com.cn
192.168.88.32   monitor.fabx.com.cn
192.168.88.32   dev.cxzx.fabx.com.cn
192.168.88.32   cxzx.fabx.com.cn

192.168.88.1    ros.fabx.com.cn
192.168.88.12   jenkins.fabx.com.cn
192.168.88.20   file.fabx.com.cn

192.168.88.32   api.fabx.com.cn
192.168.88.5    dock.fabx.com.cn
192.168.88.8    lab.fabx.com.cn
192.168.88.8    gitlab.fabx.com.cn

etcdctl --endpoints=http://10.200.169.32:2379 get / --prefix --keys-only|xargs -i sh -c 'etcdctl --endpoints=http://10.200.169.32:2379 del {}'


etcdctl --endpoints=http://10.200.169.32:2379 get / --prefix --keys-only|grep -E "coredns|kube-apiserver|kube-scheduler|kube-dns|flannel|kube-system|tiller|kube-public|minions"|xargs -i sh -c 'etcdctl --endpoints=http://10.200.169.32:2379 del {}'




//fs.writeFile('%s', JSON.stringify(idx));



if (!fieldLength) continue




void(this.length+=1)


return 0===i.length?void(0):(i in n||(n[i]={docs:{}}),0===r.length?(n[i].docs[t.ref]=t,void(this.length+=1)):this.add(r,t,n[i]))



  while(0 === i.length){r = r.slice(1),i = r.charAt(0)}



Prometheus监控server安装配置
Http数据采集组件pushgateway安装配置
Windows服务器wmi_exporter安装配置
Linux服务器node_exporter安装配置
Grafana安装配置
串联Prometheus+pushgateway+wmi_exporter+node_exporter+Grafana


K8S可视化组件weave安装配置


kubernetes提供一个规范来描述集群的架构，定义服务的最终状态，将系统自动得达到和维持在这个状态。保证系统的敏捷、可靠、高弹性、易扩展、故障隔离保护、不中断业务持续更新



Linux+Java+Spring+Mysql+Tomcat+ActiveMQ