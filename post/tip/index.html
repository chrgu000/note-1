<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tip</title>
<meta name="description" content=" John Doe&#39;s Personal blog about everything">
<meta name="generator" content="Hugo 0.17" />
<meta property="og:title" content="tip" />
<meta property="og:description" content="tip 启动虚拟机 # mysql(196.168.1.216) vmrun -T ws start &quot;/root/vmware/CentOS-mysql/CentOS-mysql.vmx&quot; nogui 启动mysql [root@Mysql ~]# service mysqld start 启动httpd/bugzilla [root@Mysql ~]# service httpd start # svn(196.168.1.224) vmrun -T ws start &quot;/root/vmware/CentOS-svn-bak/CentOS-mysql.vmx&quot; nogui 启动svn svnserve -d -r /home/svn/  终端shell连接数据库乱码 mysql -uroot -h192.168.1.123 -p --default-character-set=utf8  mysql&gt; show variables like &#39;char%&#39;; &#43;--------------------------&#43;----------------------------&#43; | Variable_name | Value | &#43;--------------------------&#43;----------------------------&#43; | character_set_client | latin1 | | character_set_connection | latin1 | | character_set_database | latin1 | | character_set_filesystem | binary | | character_set_results | latin1 | | character_set_server | latin1 | | character_set_system | utf8 | | character_sets_dir | /usr/share/mysql/charsets/ | &#43;--------------------------&#43;----------------------------&#43;  mysql备份数据库 &#43;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/tip/" />


<meta property="og:updated_time" content="2017-01-01T00:00:00&#43;00:00"/>











<link rel="stylesheet" href="/css/google-font.css?family=Open+Sans:400,400italic,700,600" type="text/css" media="all" />
<link rel="stylesheet" href="/css/atom-one-dark.css">
<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
<link rel="stylesheet" href="/css/custom.css" type="text/css" media="all" />
<link rel="stylesheet" href="/css/jquery.bigautocomplete.css" type="text/css" media="all" />
<link rel="stylesheet" href="/css/jquery.tocify.css" type="text/css" media="all" />
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/fonts/fontawesome-webfont.svg" rel="stylesheet">

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script type="text/javascript" src="/js/scripts.js"></script>
<!--[if lt IE 9]>
	<script src="/js/css3-mediaqueries.js"></script>
<![endif]-->

<script data-main="/js/app.js" src="/js/require.js"></script>

</head>
<body id="mr-mobile" class="home blog mr-right-sb" itemscope="itemscope" itemtype="http://schema.org/WebPage">
	<div class="mr-container mr-container-outer">
		<div class="mr-header-mobile-nav clearfix"></div>
			<header class="mr-header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
				<div class="mr-container mr-container-inner mr-row clearfix">
					<div class="mr-custom-header clearfix">
						<div class="mr-site-identity">
							<div class="mr-site-logo" role="banner" itemscope="itemscope" itemtype="http://schema.org/Brand">
								<div class="mr-header-text">
									<a class="mr-header-text-link" href="/" title="工作笔记" rel="home">
										<h1 class="mr-header-title">工作笔记</h1>
										<h2 class="mr-header-tagline">点滴记录</h2>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="mr-main-nav-wrap">
					<nav class="menu" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<ul class="menu__list">
		
	</ul>
</nav>
				</div>
			</header>
		<div class="mr-wrapper clearfix">


<div class="mr-content" id="main-content" role="main" itemprop="mainContentOfPage">
	<article class="post">
		<header class="entry-header clearfix">
			<h1 class="entry-title">tip</h1>
			<p class="mr-meta entry-meta">
				<svg class="icon icon-time" height="14" viewBox="0 0 16 16" width="14" xmlns="http://www.w3.org/2000/svg"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
				<time class="entry-meta-date updated" datetime="2017-01-01 00:00:00 &#43;0000 UTC">January 01, 2017</time>
			</p>
		</header>
		<div class="entry-content clearfix">
			
			

<h1 id="tip">tip</h1>

<h3 id="启动虚拟机">启动虚拟机</h3>

<pre><code class="language-bash"># mysql(196.168.1.216)
vmrun -T ws start &quot;/root/vmware/CentOS-mysql/CentOS-mysql.vmx&quot; nogui

启动mysql
[root@Mysql ~]# service mysqld start
启动httpd/bugzilla
[root@Mysql ~]# service httpd start

# svn(196.168.1.224)
vmrun -T ws start &quot;/root/vmware/CentOS-svn-bak/CentOS-mysql.vmx&quot; nogui

启动svn
svnserve -d -r /home/svn/
</code></pre>

<h3 id="终端shell连接数据库乱码">终端shell连接数据库乱码</h3>

<pre><code class="language-sql">mysql -uroot -h192.168.1.123 -p --default-character-set=utf8
</code></pre>

<pre><code class="language-sql">mysql&gt; show variables like 'char%';
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
</code></pre>

<h3 id="mysql-备份数据库"><code>mysql</code>备份数据库</h3>

<p>+</p>

<pre><code class="language-sql"> mysqldump mailiqing -uroot -h192.168.1.127 -p --default-character-set=utf8 --ignore-table=mailiqing.ti_normal_asphaltpara
</code></pre>

<h3 id="注释">注释</h3>

<pre><code class="language-java">
/*----------  -----start----------------*/

/*----------  -----end----------------*/



</code></pre>

<h3 id="测试-正式-打包-解包">测试/正式 打包/解包</h3>

<pre><code class="language-bash">[root@jinzhaoAgent webapps]# tar -zcPvf ../bak/b2b2015-09-28.tar.gz --exclude=b2b/WEB-INF --exclude=b2b/special --exclude=b2b/data --exclude=b2b/images b2b/*

[root@jinzhaoAgent apache-tomcat-7.0.62]# tar -zxvf bak/b2b2015-09-28-119.tar.gz -C webapps


</code></pre>

<h4 id="本地virtualbox-服务器目录配置">本地VirtualBox 服务器目录配置</h4>

<pre><code>HOSTNAME            IPADDR                TYPE
--------            ------                ----
CentOS-Lvs-Master   192.168.137.108       Lvs-Master
CentOS-Data-01      192.168.137.107       Data-01
CentOS-Web-02       192.168.137.101       Web-02
</code></pre>

<blockquote>
<p>hosts映射</p>
</blockquote>

<pre><code>192.168.137.108   CentOS-Lvs-Master
10.0.2.107        CentOS-Data-01
10.0.2.101        CentOS-Web-01
10.0.2.102        CentOS-Web-02
</code></pre>

<blockquote>
<p>目录设置</p>
</blockquote>

<pre><code>CentOS-Data-01
    nfs挂载目录:/usr/data/rpm
</code></pre>

<p>scp /etc/rc.d/init.d/nginx CentOS-Web-02:/etc/rc.d/init.d/</p>

<h3 id="服务器目录配置"><code>服务器目录配置</code></h3>

<blockquote>
<p>软件存放位置</p>
</blockquote>

<ul>
<li><code>/usr/local/src/rpm</code></li>
</ul>

<pre><code>192.168.1.111
192.168.1.112

192.168.1.121       Mlq-Web-Ceshi
192.168.1.123       Mlq-Sql-master  数据库
192.168.1.124       Mlq-Web-R1
    nfs:
        挂载:
        mount -t nfs -o rsize=8192,wsize=8192 192.168.1.126:/usr/mailiqing/data /usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/data
192.168.1.125       Mlq-Web-R2


192.168.1.126       Mlq-Data
    nfs:
        /usr/local/src/rpm 192.168.1.0/24(rw)   软件
        /usr/mailiqing/data 192.168.1.0/24(rw)  data目录
192.168.1.127       Mlq-Sql-slave  数据库
192.168.1.128       Mlq-Web-Zhengshi
</code></pre>

<blockquote>
<p>host:</p>
</blockquote>

<pre><code>192.168.1.124   Mlq-Web-R1
192.168.1.125   Mlq-Web-R2
192.168.1.126   Mlq-Data
</code></pre>

<blockquote>
<p>查看日志</p>
</blockquote>

<pre><code>tail -f /usr/tomcat/apache-tomcat-7.0.62/logs/catalina.out
</code></pre>

<hr />

<h3 id="正式服务器发布-脚本">正式服务器发布 脚本</h3>

<ul>
<li><strong>deploy.sh</strong>
<code>bash
#!/bin/bash
IP_ARRAY=(&quot;Mlq-Web-R1&quot; &quot;Mlq-Web-R2&quot;)
USER=&quot;root&quot;
REMOTE_CMD=&quot;/home/dishui/scripts/unpack.sh&quot;
DATE=$(date +%Y-%m-%d)
FILE=&quot;/tmp/b2b$DATE.tar.gz&quot;
tar -zcPvf $FILE --exclude=/usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/data --exclude=/usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/special /usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/*
echo &quot;测试打包完毕----&quot;
for IP in ${IP_ARRAY[*]}
do
scp $FILE $IP:/tmp
echo &quot;$ip--拷贝成功&quot;
sleep 5
ssh -t -p 22 $USER@$IP $REMOTE_CMD
done
</code></li>
<li><strong>unpack.sh</strong>
<code>bash
#!/bin/bash
DATE=$(date +%Y-%m-%d)
FILE=&quot;/tmp/b2b${DATE}.tar.gz&quot;
tar -zxvf $FILE /
</code></li>
</ul>

<h3 id="批量重启-tomcat">批量重启<code>Tomcat</code></h3>

<ul>
<li><strong>tomcat.sh</strong>
<code>bash
#!/bin/bash
IP_ARRAY=(&quot;Mlq-Web-R1&quot; &quot;Mlq-Web-R2&quot;)
USER=&quot;root&quot;
REMOTE_CMD_START=&quot;nohup sh /home/dishui/scripts/start-tom.sh&gt;/dev/null 2&gt;&amp;1&quot;
REMOTE_CMD_STOP=&quot;nohup sh /home/dishui/scripts/stop-tom.sh&gt;/dev/null 2&gt;&amp;1&quot;
case $1 in
start | begin)
  for IP in ${IP_ARRAY[*]}
  do
    ssh -t -p 22 $USER@$IP $REMOTE_CMD_START
            echo &quot;$IP--启动成功!&quot;
  done
;;
stop | end)
  for IP in ${IP_ARRAY[*]}
  do
    ssh -t -p 22 $USER@$IP $REMOTE_CMD_STOP
            echo &quot;$IP--关闭成功!&quot;
  done
;;
restart)
  for IP in ${IP_ARRAY[*]}
  do
    ssh -t -p 22 $USER@$IP $REMOTE_CMD_START
            echo &quot;$IP--重启成功!&quot;
  done
;;
*)
    echo &quot;你是不是傻!&quot;
    echo &quot;$0 stop 批量关闭tomcat&quot;
    echo &quot;$0 start 批量关闭tomcat&quot;
    echo &quot;$0 restart 批量重启tomcat&quot;
;;
esac
</code></li>
</ul>

<h3 id="启动-tomcat">启动<code>Tomcat</code></h3>

<ul>
<li><strong>start-tom.sh</strong>
<code>bash
#!/bin/bash
TOM_COUNT=`ps -ef|grep -c tomcat`
ONE=1
TWO=2
if [ $TOM_COUNT -ge $TWO ]; then
/usr/tomcat/apache-tomcat-7.0.62/bin/shutdown.sh
sleep 10
pid=`pgrep java`
if [ ! $pid ]; then
  echo &quot;$HOSTNAME 正在启动! &quot;
  /usr/tomcat/apache-tomcat-7.0.62/bin/startup.sh
else
  echo &quot;$HOSTNAME 没有完全杀死!&quot;
  echo &quot;请稍等!!!&quot;
  sleep 3
  kill -9 $pid
  echo &quot;$HOSTNAME 正在启动! &quot;
  /usr/tomcat/apache-tomcat-7.0.62/bin/startup.sh
fi
else
echo &quot;$HOSTNAME 正在启动! &quot;
/usr/tomcat/apache-tomcat-7.0.62/bin/startup.sh
fi
</code></li>
</ul>

<h3 id="关闭tomcat">关闭Tomcat</h3>

<ul>
<li><strong>stop-tom.sh</strong>
<code>bash
#!/bin/bash
TOM_COUNT=`ps -ef|grep -c tomcat`
ONE=1
TWO=2
if [ $TOM_COUNT -ge $TWO ]; then
/usr/tomcat/apache-tomcat-7.0.62/bin/shutdown.sh
sleep 10
pid=`pgrep java`
if [ ! $pid ]; then
  echo &quot;$HOSTNAME 已关闭! &quot;
else
  echo &quot;$HOSTNAME 没有完全杀死!&quot;
  echo &quot;请稍等!!!&quot;
  sleep 3
  kill -9 $pid
  echo &quot;$HOSTNAME 已被完全干掉!&quot;
fi
else
echo &quot;$HOSTNAME 已关闭! &quot;
fi
</code></li>
</ul>

<h3 id="部分文件部署到正式服务器">部分文件部署到正式服务器</h3>

<ul>
<li><strong>copy.sh</strong>
<code>bash
#!/bin/bash
while read LINE
do
if [ -f $LINE ]; then
echo &quot;$LINE is 文件&quot;
scp ${myline} Mlq-Web-R1:${myline%/*} &amp;&amp;\
scp ${myline} Mlq-Web-R2:${myline%/*}
elif [ -d $LINE ]; then
echo &quot;$LINE is 文件夹&quot;
scp -r ${LINE} Mlq-Web-R1:${LINE} &amp;&amp;\
scp -r ${LINE} Mlq-Web-R2:${LINE}
else
echo &quot;$LINE 不存在&quot;
fi
done &lt; $1
</code></li>
</ul>

<h3 id="备份">备份</h3>

<ul>
<li><strong>backup.sh</strong>
<code>bash
#!/bin/bash
ip_array=(&quot;Mlq-Web-R1&quot; &quot;Mlq-Web-R2&quot;)
user=&quot;root&quot;
remote_cmd=&quot;/home/dishui/scripts/pack.sh&quot;
DATE=$(date +%Y-%m-%d)
for ip in ${ip_array[*]}
do
ssh -t -p 22 $user@$ip $remote_cmd
done
</code></li>
</ul>

<h3 id="脚本使用"><strong>脚本使用</strong></h3>

<p>+</p>

<pre><code class="language-bash">#Mlq-Web-R1,Mlq-Web-R2备份到每个机器的当前目录下
sh /home/dishui/scripts/backup.sh
#测试服务器部署到正式服务器
sh /home/dishui/scripts/deploy.sh
#批量操作Tomcat
sh /home/dishui/scripts/tomcat.sh start|stop|restart
#部分文件部署到正式服务器
cd /home/dishui/scripts
vim filelist
#将需要部署的文件地址添加到filelist文件
#例:(每个地址一行)
#/usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/program/company/goods/goodsList.jsp
#/usr/tomcat/apache-tomcat-7.0.62/webapps/b2b/special/111
# i 进入编辑模式, esc 退出编辑模式, :wq 保存退出
sh copy.sh filelist
</code></pre>

<h3 id="本地-mysql-svn">本地<code>mysql</code>、<code>svn</code></h3>

<ul>
<li>服务器</li>
</ul>

<p>| 主机  | 196.168.1.220 |
| &ndash; | &ndash; |
| mysql | 196.168.1.216 |
| svn | 196.168.1.224 |</p>

<ul>
<li><p><strong>操作</strong></p>

<ol>
<li><p>查看虚拟机是否启动</p>

<pre><code class="language-bash"># vmrun list
Total running VMs: 2
/root/vmware/CentOS-mysql/CentOS-mysql.vmx
/root/vmware/CentOS-svn-bak/CentOS-mysql.vmx
#有以上信息说明,已经启动
</code></pre></li>

<li><p>启动虚拟机</p>

<pre><code class="language-bash">#ssh 连接 196.168.1.220
#启动216
vmrun -T ws start &quot;/root/vmware/CentOS-mysql/CentOS-mysql.vmx&quot; nogui
#启动224
vmrun -T ws start &quot;/root/vmware/CentOS-svn-bak/CentOS-mysql.vmx&quot; nogui
#重启
vmrun reset &quot;/root/vmware/CentOS-svn-bak/CentOS-mysql.vmx&quot; hard
</code></pre></li>

<li><p>启动<code>mysql</code></p>

<pre><code class="language-bash">#ssh 登录216
#启动mysql
service mysqld start
</code></pre></li>

<li><p>启动<code>svn</code></p>

<pre><code class="language-bash">#ssh 登录224
#启动svn
svnserve -d -r /home/svn/
</code></pre></li>
</ol></li>
</ul>

		</div>
		
	</article>
	
<div class="mr-author-box clearfix">
	<figure class="mr-author-box-avatar">
		<img alt="dishui avatar" src="/src/img/dishui.png" class="avatar avatar-90 photo" height="90" width="90">
	</figure>
	<div class="mr-author-box-header">
		<span class="mr-author-box-name">About dishui</span>
	</div>
	<div class="mr-author-box-bio">
		辛勤的搬运工!!!
	</div>
</div>

	

	<nav class="mr-post-nav mr-row clearfix" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
		
		<div class="mr-col-1-2 mr-post-nav-item mr-post-nav-prev">
			<a href="/post/linux/docker-swarm/" rel="prev"><span>«Previous</span><p>swarm</p></a>
		</div>
		
		
		<div class="mr-col-1-2 mr-post-nav-item mr-post-nav-next">
			<a href="/post/linux/ubuntu/" rel="next"><span>Next»</span><p>ubuntu</p></a>
		</div>
		
	</nav>


	
</div>

<aside class="mr-sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
<div class="mr-widget widget_search navbar-wrapper" >
    <form class="search-form" role="search" >
        <label>
            <span class="screen-reader-text">Search for:</span>
            <input id="lanren" type="search" class="search-field" placeholder="Search..." value="" name="q">
        </label>
        <div id="list-container" class="bdsug" style="height: auto; display: block;">
        </div>
    </form>
    <div id="side-toc" class="entry-content">
    
    </div>
</div>
</aside>
	</div>
		<div class="mr-copyright-wrap">
			<div class="mr-container mr-container-inner clearfix">
				<p class="mr-copyright">&copy; 2017 工作笔记. Based on <a href="//wordpress.org/themes/mh-magazine-lite/" target="_blank" rel="nofollow noopener noreferrer">MH Magazine lite</a>.</p>
			</div>
		</div>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script>



</body>
</html>